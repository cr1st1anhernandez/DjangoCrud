{% extends 'base.html' %}

{% block title %}Detalle del Historial{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Botón volver -->
    <div class="mb-8">
        <a href="{% url 'history_list' %}" class="flex items-center text-base transition-colors" style="color: var(--soft-gray);"
           onmouseover="this.style.color='var(--dark-brown)'"
           onmouseout="this.style.color='var(--soft-gray)'">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Volver al Historial
        </a>
    </div>

    <!-- Header -->
    <div class="mb-12">
        <h1 class="editorial-title mb-3" style="color: var(--dark-brown);">Detalle del Cambio</h1>
        <p class="text-base" style="color: var(--soft-gray); letter-spacing: 0.5px;">Información completa sobre esta modificación</p>
    </div>

    <!-- Información General -->
    <div class="minimal-card p-8 mb-8">
        <h2 class="serif text-2xl mb-8" style="color: var(--dark-brown); font-weight: 400; letter-spacing: 1px;">
            Información General
        </h2>

        <div class="grid grid-cols-2 gap-8 mb-8">
            <div>
                <p class="text-xs mb-2" style="color: var(--soft-gray); letter-spacing: 1.5px; text-transform: uppercase;">
                    Usuario
                </p>
                <p class="text-lg font-medium" style="color: var(--dark-brown);">
                    {{ history.user.username }}
                </p>
            </div>
            <div>
                <p class="text-xs mb-2" style="color: var(--soft-gray); letter-spacing: 1.5px; text-transform: uppercase;">
                    Acción
                </p>
                {% if history.action == 'CREATE' %}
                <span class="inline-block px-4 py-2 rounded text-sm font-medium" style="background-color: rgba(34, 197, 94, 0.1); color: #16a34a; letter-spacing: 0.5px;">
                    Creación
                </span>
                {% elif history.action == 'UPDATE' %}
                <span class="inline-block px-4 py-2 rounded text-sm font-medium" style="background-color: rgba(234, 179, 8, 0.1); color: #ca8a04; letter-spacing: 0.5px;">
                    Edición
                </span>
                {% elif history.action == 'DELETE' %}
                <span class="inline-block px-4 py-2 rounded text-sm font-medium" style="background-color: rgba(239, 68, 68, 0.1); color: #dc2626; letter-spacing: 0.5px;">
                    Eliminación
                </span>
                {% endif %}
            </div>
        </div>

        <div class="grid grid-cols-2 gap-8 pb-8" style="border-bottom: 1px solid var(--beige);">
            <div>
                <p class="text-xs mb-2" style="color: var(--soft-gray); letter-spacing: 1.5px; text-transform: uppercase;">
                    Producto
                </p>
                <p class="text-lg" style="color: var(--dark-brown);">
                    {{ history.product_name }}
                </p>
            </div>
            <div>
                <p class="text-xs mb-2" style="color: var(--soft-gray); letter-spacing: 1.5px; text-transform: uppercase;">
                    ID del Producto
                </p>
                <p class="text-lg font-mono" style="color: var(--dark-brown);">
                    {{ history.product_id }}
                </p>
            </div>
        </div>

        <div class="pt-8">
            <p class="text-xs mb-2" style="color: var(--soft-gray); letter-spacing: 1.5px; text-transform: uppercase;">
                Fecha y Hora
            </p>
            <p class="text-lg" style="color: var(--dark-brown);">
                {{ history.timestamp|date:"d/m/Y" }} a las {{ history.timestamp|date:"H:i:s" }}
            </p>
        </div>
    </div>

    <!-- Detalles de los Cambios -->
    <div class="minimal-card p-8">
        <h2 class="serif text-2xl mb-8" style="color: var(--dark-brown); font-weight: 400; letter-spacing: 1px;">
            Detalles de los Cambios
        </h2>

        {% if history.action == 'CREATE' %}
        <div class="p-6 rounded" style="background-color: rgba(34, 197, 94, 0.05); border: 1px solid rgba(34, 197, 94, 0.2);">
            <h3 class="serif text-lg mb-6" style="color: #16a34a; font-weight: 400;">
                Datos del Producto Creado
            </h3>
            <dl class="space-y-4">
                {% for key, value in changes.items %}
                <div class="flex justify-between items-start pb-4" style="border-bottom: 1px solid rgba(34, 197, 94, 0.1);">
                    <dt class="text-sm font-medium" style="color: var(--soft-gray); letter-spacing: 0.5px;">
                        {% if key == 'name' %}Nombre
                        {% elif key == 'description' %}Descripción
                        {% elif key == 'price' %}Precio
                        {% elif key == 'quantity' %}Cantidad
                        {% elif key == 'sku' %}SKU
                        {% else %}{{ key|capfirst }}
                        {% endif %}
                    </dt>
                    <dd class="text-sm font-medium text-right" style="color: var(--dark-brown);">{{ value }}</dd>
                </div>
                {% endfor %}
            </dl>
        </div>

        {% elif history.action == 'UPDATE' %}
        <div class="space-y-6">
            {% if changes %}
                {% for key, value in changes.items %}
                <div class="p-6 rounded" style="background-color: rgba(234, 179, 8, 0.05); border: 1px solid rgba(234, 179, 8, 0.2);">
                    <h3 class="serif text-lg mb-6" style="color: #ca8a04; font-weight: 400;">
                        {% if key == 'name' %}Nombre
                        {% elif key == 'description' %}Descripción
                        {% elif key == 'price' %}Precio
                        {% elif key == 'quantity' %}Cantidad
                        {% elif key == 'sku' %}SKU
                        {% else %}{{ key|capfirst }}
                        {% endif %}
                    </h3>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <p class="text-xs mb-2" style="color: var(--soft-gray); letter-spacing: 1px; text-transform: uppercase;">
                                Antes
                            </p>
                            <p class="text-base p-3 rounded" style="color: var(--dark-brown); background-color: rgba(255, 255, 255, 0.5);">
                                {{ value.old }}
                            </p>
                        </div>
                        <div>
                            <p class="text-xs mb-2" style="color: var(--soft-gray); letter-spacing: 1px; text-transform: uppercase;">
                                Después
                            </p>
                            <p class="text-base font-medium p-3 rounded" style="color: #16a34a; background-color: rgba(34, 197, 94, 0.1);">
                                {{ value.new }}
                            </p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="p-8 rounded text-center" style="background-color: var(--ivory); border: 1px solid var(--beige);">
                    <p class="text-base" style="color: var(--soft-gray);">No se detectaron cambios</p>
                </div>
            {% endif %}
        </div>

        {% elif history.action == 'DELETE' %}
        <div class="p-6 rounded" style="background-color: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2);">
            <h3 class="serif text-lg mb-6" style="color: #dc2626; font-weight: 400;">
                Datos del Producto Eliminado
            </h3>
            <dl class="space-y-4">
                {% for key, value in changes.items %}
                <div class="flex justify-between items-start pb-4" style="border-bottom: 1px solid rgba(239, 68, 68, 0.1);">
                    <dt class="text-sm font-medium" style="color: var(--soft-gray); letter-spacing: 0.5px;">
                        {% if key == 'name' %}Nombre
                        {% elif key == 'description' %}Descripción
                        {% elif key == 'price' %}Precio
                        {% elif key == 'quantity' %}Cantidad
                        {% elif key == 'sku' %}SKU
                        {% else %}{{ key|capfirst }}
                        {% endif %}
                    </dt>
                    <dd class="text-sm font-medium text-right" style="color: var(--dark-brown);">{{ value }}</dd>
                </div>
                {% endfor %}
            </dl>
        </div>
        {% endif %}
    </div>

    <!-- Botón Volver -->
    <div class="mt-8">
        <a href="{% url 'history_list' %}"
           class="minimal-btn px-8 py-3 rounded inline-block"
           style="background-color: var(--ivory); color: var(--dark-brown); border: 1px solid var(--beige);">
            Volver al Historial
        </a>
    </div>
</div>
{% endblock %}
