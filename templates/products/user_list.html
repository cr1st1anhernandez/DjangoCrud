{% extends 'base.html' %}

{% block title %}Gestión de Usuarios{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="mb-12">
        <div class="flex justify-between items-end">
            <div>
                <h1 class="editorial-title mb-3">
                    Gestión de Usuarios
                </h1>
                <p class="text-base color-secondary" style="letter-spacing: 0.5px;">
                    Administra los usuarios del sistema
                </p>
            </div>
            <a href="{% url 'user_create' %}"
               class="minimal-btn btn-primary px-6 py-3 rounded">
                Nuevo Usuario
            </a>
        </div>
    </div>

    <!-- Users List -->
    <div class="minimal-card-no-hover overflow-hidden">
        <!-- Table Header -->
        <div class="table-header">
            <div class="grid grid-cols-12 gap-4">
                <div class="col-span-4">
                    <span class="table-header-text">Usuario</span>
                </div>
                <div class="col-span-4">
                    <span class="table-header-text">Correo Electrónico</span>
                </div>
                <div class="col-span-2">
                    <span class="table-header-text">Rol</span>
                </div>
                <div class="col-span-2 text-right">
                    <span class="table-header-text">Acciones</span>
                </div>
            </div>
        </div>

        <!-- Table Body -->
        <div>
            {% for user_item in users %}
            <div class="table-row">
                <div class="grid grid-cols-12 gap-4 items-center">
                    <!-- Usuario -->
                    <div class="col-span-4 flex items-center space-x-4">
                        <div class="avatar avatar-sm avatar-gradient">
                            <span class="font-semibold text-white">
                                {{ user_item.username|slice:":1"|upper }}
                            </span>
                        </div>
                        <div>
                            <p class="text-base font-semibold color-primary">
                                {{ user_item.username }}
                            </p>
                            {% if user_item == user %}
                            <p class="text-xs color-accent">
                                (Usuario Actual)
                            </p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="col-span-4">
                        <p class="text-sm color-secondary">
                            {{ user_item.email }}
                        </p>
                    </div>

                    <!-- Rol -->
                    <div class="col-span-2">
                        {% if user_item.profile.is_admin %}
                        <span class="badge badge-admin">ADMIN</span>
                        {% else %}
                        <span class="badge badge-seller">
                            {% if user_item.profile.role == 'SELLER' %}VENDEDOR{% else %}USUARIO{% endif %}
                        </span>
                        {% endif %}
                    </div>

                    <!-- Acciones -->
                    <div class="col-span-2 text-right">
                        {% if user_item != user %}
                        <form method="POST" action="{% url 'user_delete' user_item.pk %}" class="inline"
                              onsubmit="return confirm('¿Estás seguro de eliminar a {{ user_item.username }}?');">
                            {% csrf_token %}
                            <button type="submit" class="minimal-btn btn-danger px-4 py-2 rounded text-xs">
                                Eliminar
                            </button>
                        </form>
                        {% else %}
                        <span class="inline-flex items-center px-4 py-2 rounded text-xs bg-ivory color-secondary border border-beige">
                            —
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="px-8 py-16 text-center">
                <svg class="w-16 h-16 mx-auto mb-4 color-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <p class="text-base color-secondary">
                    No hay usuarios registrados
                </p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
